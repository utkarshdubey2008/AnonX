from flask import Flask, request, jsonify, render_template
import os
import random

app = Flask(__name__)
upload_folder = 'uploads/'
app.config['UPLOAD_FOLDER'] = upload_folder

# Ensure upload directory exists
os.makedirs(upload_folder, exist_ok=True)

# Simulating a database
posts = []

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/submit', methods=['POST'])
def submit():
    text = request.form['text']
    file = request.files['file']
    filename = file.filename
    file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))

    post_id = len(posts) + 1
    posts.append({'id': post_id, 'text': text, 'file': os.path.join(upload_folder, filename), 'likes': 0})
    return jsonify(success=True)

@app.route('/get_random_posts', methods=['GET'])
def get_random_posts():
    random_posts = random.sample(posts, min(len(posts), 10))  # Return up to 10 random posts
    return jsonify(random_posts)

@app.route('/like/<int:post_id>', methods=['POST'])
def like(post_id):
    for post in posts:
        if post['id'] == post_id:
            post['likes'] += 1
            break
    return jsonify(success=True)

if __name__ == '__main__':
    app.run(debug=True)
