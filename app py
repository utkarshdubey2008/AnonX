from flask import Flask, request, jsonify, render_template
import os
import random

app = Flask(__name__, static_folder='static', template_folder='templates')

# Configure the upload folder
upload_folder = 'uploads/'
app.config['UPLOAD_FOLDER'] = upload_folder

# Ensure upload directory exists
os.makedirs(upload_folder, exist_ok=True)

# Simulating a database
posts = []

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/submit', methods=['POST'])
def submit():
    text = request.form.get('text')  # Get the text input
    file = request.files.get('file')  # Get the uploaded file

    # Check if a file was uploaded
    if file:
        filename = file.filename
        file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))

        # Create a new post with the submitted text and image
        post_id = len(posts) + 1
        posts.append({
            'id': post_id,
            'text': text,
            'file': os.path.join(upload_folder, filename),
            'likes': 0
        })
        return jsonify(success=True)
    else:
        return jsonify(success=False, message="No file uploaded."), 400

@app.route('/get_random_posts', methods=['GET'])
def get_random_posts():
    random_posts = random.sample(posts, min(len(posts), 10))  # Return up to 10 random posts
    return jsonify(random_posts)

@app.route('/like/<int:post_id>', methods=['POST'])
def like(post_id):
    for post in posts:
        if post['id'] == post_id:
            post['likes'] += 1
            break
    return jsonify(success=True)

if __name__ == '__main__':
    app.run(debug=True)
